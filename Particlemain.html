<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        background-color: black;
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="640" height="640" style="border:1px solid #c3c3c3;"></canvas>
    <p id="test" style="color:white">Hello am I working ?</p>
    <p id="test2" style="color:white">Hello am I working ?</p>
    <p style="color:white">Move the slider to set gravity</p>
    <input type="range" id="Gforce" max="500.0" min="10.0">
    <br>
    <input type="range" id="GcenX" max="640" min="0">
    <br>
    <input type="range" id="GcenY" max="640" min="0">
    <script>
     
      
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
        };
      })();

      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');
      var totPart = 5000; // MaxParticles
      var bounce = 0.4; 
      var dragx = 0.05;
      var dragy = 0.05;

      // Array of Squares, sooo squareeee!!! 
      var myArraySquares = [];
      var str="";
      var obj={};
      var colrswitch;
      var colstr="";
      var Fcentre={Xo: 120, Yo: 450};
      var tst,tst2;

      // Array of colours 
      colors=["#FF0000","#00FF00", "#0000FF", "#5555AA", "#00ABD0", "#FF00AA"]; 
      
      // fill the array with squares at random positions!
      fillTheArray();
     
      str +="Type of Canvas.height is " + typeof(canvas.height);
      document.getElementById("test").innerHTML=str;
      
      

        function animate(canvas, context, startTime) {
        
        var gravity = document.getElementById("Gforce").value; 
        var gcenx = parseInt(document.getElementById("GcenX").value); 
        var gceny = parseInt(document.getElementById("GcenY").value); 
        
        var oldX;
        var oldY;
        var velX;
        var velY;
        var newX;
        var newY;
        var Forcex;
        var Forcey;
        var Fdis, Fang;
        var weight;
        var strg="";
        var time = (new Date()).getTime() - startTime;
       
        Fcentre.Xo=gcenx; 
        Fcentre.Yo=gceny;
 
        var linearSpeed = 100;
        // pixels / second
         
         strg ="GForce is " + gravity;
         document.getElementById("test2").innerHTML=strg;
        for (var i = 0; i < totPart; i++) {   //Main animation loop
          weight=myArraySquares[i].mass;
          oldX = myArraySquares[i].x;
          oldY = myArraySquares[i].y;
          velX = myArraySquares[i].vx; // * time / 1000;
          velY = myArraySquares[i].vy; // * time / 1000;
          
          Fdis = calcDistance(oldX, oldY);
          Fang = calcAngle(oldX, oldY);

          Forcex = (1.0)*(gravity/(Fdis*Fdis)*Math.sin(Fang)) + ((-1.0)* dragx * velX);
          Forcey = (1.0)*(gravity/(Fdis*Fdis)*Math.cos(Fang)) + ((-1.0)* dragy * velY);
           
          newX = oldX + velX;
          newY = oldY + velY;
          
          myArraySquares[i].x = newX;
          myArraySquares[i].y = newY;
          
          myArraySquares[i].vx = velX + (Forcex/weight);
          myArraySquares[i].vy = velY + (Forcey/weight);
    
        
        if ((myArraySquares[i].x >= canvas.width) || (myArraySquares[i].x <= 0)) { 
        myArraySquares[i].vx = (velX*bounce*(-1.0));
                        }

       // strg +="Velocity for particle is " + myArraySquares[i].vx;
        // document.getElementById("test").innerHTML=strg;
       
        if ((myArraySquares[i].y >= canvas.height) || (myArraySquares[i].y <= 0)) { 
        myArraySquares[i].vy = (velX*bounce*(-1.0));
                        }
        


                                          }  //Close main animation loop
       
       
       // Clear the Screen between frames!
       
      //context.clearRect(0, 0, canvas.width, canvas.height);
      
        // Draw the screen! 
       drawRectangle(context);

        // request new frame
        requestAnimFrame(function() {
          animate(canvas, context, startTime);
        });
      }
       

      var myRectangle = { x: 320, y: 320, width: 150, height: 100, borderWidth:2, colr: "#000FF0" };
      

      // wait 100 miliseconds second before starting animation
      setTimeout(function() {
        var startTime = (new Date()).getTime();
        animate(canvas, context, startTime);
      }, 100);
      
      
      
      // Function that fills the array with squares of random positions/velocities
     function fillTheArray(){
      for (var i = 0; i < totPart; i++) {
      colrswitch = i % colors.length;
      switch (colrswitch) {
      case 0:
      colstr = colors[0];
      break;
      case 1:
      colstr = colors[1];
      break;
      case 2:
      colstr  = colors[2];
      break;
      case 3:
      colstr  = colors[3];
      break;
      case 4:
      colstr  = colors[4];
      break;
      case 5:
      colstr  = colors[5];
      break;
      }      
      

      obj={x:(parseInt(i/canvas.width))+160,                               //parseInt(Math.random()*canvas.width), 
           y:((i % canvas.width)),                                        //parseInt(Math.random()*canvas.height), 
           vx:0,                                                    // (0.5*(10-(Math.random()*20)))
           vy:0,  
           Fx:0,
           Fy:0, 
           mass:1,                                                 //(Math.random()*2),
           width:2, 
           height:2, 
           borderWidth:0, 
           colr: colstr};
     
      myArraySquares.push(obj);     
                                         } // close loop
  
      }
     
     // Drawing function for individual squares
     function drawRectangle(context) {
        for (var i = 0; i < totPart; i++) {
        //context.beginPath();
        context.fillStyle = myArraySquares[i].colr;
        context.fillRect(myArraySquares[i].x, myArraySquares[i].y, myArraySquares[i].width, myArraySquares[i].height);
        //context.rect(myArraySquares[i].x, myArraySquares[i].y, myArraySquares[i].width, myArraySquares[i].height);
        //context.fill();
        //context.lineWidth = myArraySquares[i].borderWidth;
        //context.strokeStyle = 'black';
        //context.stroke();
        }
      }

      function calcDistance(inputx, inputy){
        //calculate distance from centre
        var inputx,inputy,xbit,ybit;
        var distance;
        
        xbit=Math.abs((inputx-Fcentre.Xo)*(inputx-Fcentre.Xo));
        ybit=Math.abs((inputy-Fcentre.Yo)*(inputy-Fcentre.Yo));
        
        distance=Math.sqrt(xbit+ybit);
        
        return distance;  
         
      }
      function calcAngle(inputx, inputy){
        //calculate distance from centre
        var inputx,inputy,xbit,ybit;
        var angle;
        
        xbit=(inputx-Fcentre.Xo);
        ybit=(inputy-Fcentre.Yo);
        
        angle=Math.atan2(ybit,xbit);
        
        return angle;
        
      } 
    </script>
  </body>
</html>      

